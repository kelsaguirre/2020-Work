---
title: "Data Challenge 4"
output: html_document
---

[github link] (https://github.com/kelseyaguirre/Data_Challenge_4.git)

```{r message = FALSE}
##call libraries
library(tidyverse)
library(magrittr)
library(mosaic)

##read files
park_visits <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-09-17/national_parks.csv")

state_pop <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-09-17/state_pop.csv")

```

## Question 1, Figure 1

```{r}
##filter out just the states I need from state_pop df
states_needed <- filter(state_pop, state %in% c("OR", "CA", "UT"))

##wrangle the data for figure 1
figure_1_data <- park_visits %>% 
  ##select my 4 columns
  select(year, parkname, visitors, state) %>% 
  ##filter by park name
  filter(parkname %in% c("Crater Lake", "Joshua Tree", "Zion")) %>% 
  ##remove the totals
  filter(year != 'Total') %>%
  ##change the year to a number so I can edit the x axis later
  mutate(year = as.numeric(year)) %>% 
  ##arrange by year
  arrange(year)
  
##figure 1 for question 1
figure_1 <- ggplot(data = figure_1_data) +
  ##set the aesthetics for the line plot, 
  #dividing visitors by 1000 to make it easier to look at
  geom_line(aes(x = year, y = visitors/10000, 
                color = parkname, group = parkname))+
  ##set the title
  ggtitle('Raw Number of Park Visitors from 1904 to 2016')+
  ##label the axis
  xlab('Year') +
  ylab('Number of Visitors/1000') +
  ##edit the x axis so the years can be seen
  scale_x_continuous(breaks = waiver()) +
  ##angle and set the size for the x axis lables
  theme(axis.text.x = element_text(size = 10, angle = 45)) +
  ##change the legend title
  labs(col = "Park Name")

#execute the graph
plot(figure_1)

```

## Question 1, Figure 2

```{r}
##wrangle the data again to add the population by state info
figure_2_data <- figure_1_data %>%
  ##combine my previous df with my 'states needed' df 
  ##with matching years and states
  inner_join(states_needed, by = c('year' = 'year', 'state' = 'state')) %>% 
  ##limit this dataframe to the following variables
  summarise(year = year,
            parkname = parkname,
            ##normalize to the population for the state the park is in
            visitors = visitors/pop)

##figure 2 for question 1  
figure_2 <- ggplot(data = figure_2_data) +
  ##set the aesthetics for the line plot
  geom_line(aes(x = year, y = visitors, 
                color = parkname, group = parkname))+
  ##set the title
  ggtitle('Number of Visitors Normalized 
to State Population from 1904 to 2015')+
  ##label the axis
  xlab('Year') +
  ylab('Number of Visitors') +
  ##edit the x axis so the years can be seen
  scale_x_continuous(breaks = waiver()) +
  ##angle and set the size for the x axis lables
  theme(axis.text.x = element_text(size = 10, angle = 45)) +
  ##change the legend title
  labs(col = "Park Name")

#execute the graph
plot(figure_2)
```

## Question 2, Simulations

```{r}
##filter for just 1941 and 1942 for each of the three parks I was using
select_years <- figure_1_data %>%
  filter(year == 1941 | year == 1942) %>%
  select(year, parkname, visitors)

##set seed for reproducibility
set.seed(42) 

##my function for my simulation, only calls for parkname
simulation <- function(parkname){
  ##select the data I want
  per_park <- select_years %>%
  ##list what I want in this dataframe
  summarise(year = year,
            parkname = parkname,
            visitors = visitors,
            ##calculating this to use the the rbinom calculation
            ttl_visitors = (visitors[1] + visitors[2]))
  ##simulate the data 1000x with size as the ttl visitors for 1941 + 1942 
  ##with equal probabiltity of 0.5
  calcs<- rbinom(n = 1000, size = per_park$ttl_visitors[1], prob =.5)
  ##turn the integer vector into a dataframe for the histogram
  calcs <- as.data.frame(calcs)
}

##run the simulation function for the first park
fig_1 <- simulation("Crater Lake")

##define ggplot data and x value
fig_1_plot <- ggplot(data = fig_1, aes(x = calcs)) +
  ##plot the simulated data and change color and binwidth
  geom_histogram(binwidth = 20, fill = 'darkblue', col = 'darkblue') +
  ##add the actual data from 1942 in the form of an x-int
  geom_vline(xintercept = select_years$visitors[4], col = 'red') +
  ##title the graph
  ggtitle('Simulated Vistors vs Actual Visitors for Crater Lake') +
  ##label the axis
  xlab('Visitors') +
  ##capitalize the counts
  ylab('Counts')
  #geom_vline(xintercept = year[1942])

##show the plot
fig_1_plot

##run the simulation function for the second park
fig_2 <- simulation("Joshua Tree")

##define ggplot data and x value
fig_2_plot <- ggplot(data = fig_2, aes(x = calcs)) +
  ##plot the simulated data and change color and binwidth
  geom_histogram(binwidth = 20, fill = 'darkblue', col = 'darkblue')+
  ##add the actual data from 1942 in the form of an x-int
  geom_vline(xintercept = select_years$visitors[6], col = 'red') +
  ##title the graph
  ggtitle('Simulated Vistors vs Actual Visitors for Joshua Tree')+
  ##label the axis
  xlab('Visitors') +
  ##capitalize the counts
  ylab('Counts')

##show the plot
fig_2_plot

##run the simulation function for the third park
fig_3 <- simulation("Zion")

##define ggplot data and x value
fig_3_plot <- ggplot(data = fig_3, aes(x = calcs)) +
  ##plot the simulated data and change color and binwidth
  geom_histogram(binwidth = 20, fill = 'darkblue', col = 'darkblue')+
  ##add the actual data from 1942 in the form of an x-int
  geom_vline(xintercept = select_years$visitors[5], col = 'red') +
  ##title the graph
  ggtitle('Simulated Vistors vs Actual Visitors for Zion Park')+
  ##label the axis
  xlab('Visitors') +
  ##capitalize the counts
  ylab('Counts')

##show the plot
fig_3_plot

```

## Question 3, Summary of Results

  In this assignment you can see that I'm taking national parks data from tidytuesday. In question one figure 1, I have year on the x-axis and number of raw visitors divided by 1000 (to clean it up) on the y-axis for the three different lakes listed in the key. With just the raw values it appears Zion Park and Joshua Tree are both a lot more popular than Crater Lake starting in about 1975 to 2016. For question 1 figure 2, I have the same setup as figure 1, but I normailzed the yearly number of visitors for each park to the corresponding total population. In this figure it's very clear that theres a serious decrease in visitors from 1941 to 1942 for Zion and Crater Lake. This figure also makes it obvious that Zion is significantly more popular than the other two parks, which wasn't as clear in the first figure. For question two I created a simulation that uses the number of actual total visitors for 1941 and 1942 to recreate the data with equal probability of the visitor, visiting in either 1941 or 1942, and ran that simulation 1000 times. Here you can see the simulated histogram compared to the x-intercept (in red) of the actual visitors. Since the simulated data is so drastically different than the actual, I think there may be either a problem with the original dataset for the year 1942, or people stopped going to parks for the year due to a major event that occured in 1942.
